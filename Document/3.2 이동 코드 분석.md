#  이동 코드 분석 

## ARealPlayPlayerController::SetNewDestination

 - FVector::Dist 
 - UAIBlueprintHelperLibrary::SimpleMoveToLocation 

## UAiBlueprintHelperLibrary::SimpleMoveToLocation 

- FNavigationSystem::GetCurrent<UNavigationSystemV1>(Controller->GetWorld()) 
	
	- Controller->GetWorld() 

		- GetOuter()로 ULevel 타잎을 찾아서 돌려준다.
		- Destroy 중이거나 Outer가 없으면 못 찾는다. 
		- 이와 같이 UObject (UClass 등등)에 많이 의존하는 부분이다.
		- UWorld는 크고 중요하다.

	- UNavigationSystemV1을 UWorld가 갖고 있다. 

		- 이것도 크다. RecastDetour 데이터 이외에 여러 가지 설정과 선택을 갖고 있다. 

	- UPathFollowComponent 

		- 컴포넌트도 크다. 언리얼은 모든 게 크다.
		- UCrowdFollowingComponent도 있다.
		- 핵심은 당연히 Path를 따라 가는 것이다. 
		- 멤버 변수들의 사용을 이해하고 기억해야 한다. 

## UE_VLOG

- Capture를 시작하면 비주얼 데이터를 수집한다. 
- 그래프 보기를 하면 경로를 그림으로 보여준다. 
- 경로 이동의 개념을 이해하는 데 도움이 많이 된다.

Detour와 Crowd를 이해해야 경로 이동을 잘 알 수 있다. 
세부적인 if / else 는 점차 포괄해 나가야 한다. 

## 과제 

- 귀퉁이에 갔을 때 이동이 안 되는 경우가 있다. 길을 못 찾는 경우인데 원인이 무엇일까? 
	- 이를 찾아야 제대로 잘 움직일 수 있다.

FPathFindingResult Result = NavSys->FindPathSync(Query);

위 쿼리가 실패해서 발생한 문제이다. 왜 그럴까? 
 
- FPImplRecastNavMesh::InitPathfinding()에서 실패한다.
	- FImplRecastNavMesh::InitPathfinding end point not on mesh 에러이다. 
	- VLOG로 보면 네비매시 밖의 포인트이다. 
	-  {X=5448.32568 Y=714.568726 Z=-4540.37744}
	- Goal Location : {X=-5230.69531 Y=4773.61279 Z=697.452148}


>	FPImplRecastNavMesh::InitPathfinding(
 	FPImplRecastNavMesh::FindPath(
 	ARecastNavMesh::FindPath
 	ANavigationData::FindPath(
 	UNavigationSystemV1::FindPathSync
 	UAIBlueprintHelperLibrary::SimpleMoveToLocation(
 	UE4Editor-RealPlay.dll!ARealPlayPlayerController::SetNewMoveDestination
 	ARealPlayPlayerController::MoveToMouseCursor() 

호출 스택에서 결국 MoveToMouseCursor()에서 얻어온 좌표가 이상하다. 
왜냐하면 EndPoint가 목적지이고 이는 마우스 커서로 Hit 한 위치에서 찾은 지점이기 때문이다.

+		GoalLocation	{X=-4683.20557 Y=4637.76465 Z=169.093811}	const FVector &

알았다. 

- 벽 뒷면이 그려지지 않는다. 
- 카메라가 벽 뒤로 간다. 
- 마우스 좌표 Hit 지점이 벽이다. 
- 따라서, 이동이 불가하다. 


- 캐릭터가 네비매시 상에 서 있는 듯한 느낌이다. 정확하게 매시에 붙게 할 수 없는가? 

https://www.youtube.com/watch?v=cqI1nKnyzdg
- IK tutorial이다. 
- 이것이 답인데 C++에서 하고 결과를 확인한다. 
- Two Bone IK 

큰 주제이고 애님과 연관되므로 애님에서 다룬다. 


















	
